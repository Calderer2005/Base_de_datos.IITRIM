–RELACION JUEGOS Y CONSOLAS
CREATE TABLE VIDEOJUEGOS(
    ID_VIDEOJUEGOS INT CHECK (ID_VIDEOJUEGOS >=0) PRIMARY KEY,
    TITULO VARCHAR(50) NOT NULL,
    PEGI VARCHAR(3) CHECK (PEGI IN('+3', '+7', '+12', '+16', '+18')),
    ID_DESARROLLADORA INT CHECK(ID_DESARROLLADORA >=0),

    CONSTRAINT FK_VIDEOJUEGOS_DESA FOREIGN KEY (ID_DESARROLLADORA) REFERENCES DESARROLLADORES(ID_DESARROLLADORA)
)
--drop table videojuegos

CREATE TABLE DESARROLLADORES(
    ID_DESARROLLADORA INT CHECK(ID_DESARROLLADORA >=0) PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL,
    PAIS_ORIGEN VARCHAR(50),
    AÑO_FUNDACION DATE
)
--drop table desarrolladores

CREATE TABLE LANZAMIENTOS(
    ID_VIDEOJUEGOS INT CHECK(ID_VIDEOJUEGOS >= 0),
    ID_CONSOLA INT CHECK (ID_CONSOLA >= 0),
    FECHA_LANZAMIENTO DATE,

    CONSTRAINT PK_LANZAMIENTO PRIMARY KEY (ID_VIDEOJUEGOS, ID_CONSOLA, FECHA_LANZAMIENTO),
    CONSTRAINT FK_LANZA_JUEGO FOREIGN KEY (ID_VIDEOJUEGOS) REFERENCES VIDEOJUEGOS(ID_VIDEOJUEGOS),
    CONSTRAINT FK_LANZA_CONSO FOREIGN KEY (ID_CONSOLA) REFERENCES CONSOLAS(ID_CONSOLA)
)
--drop table lanzamientos

CREATE TABLE CONSOLAS(
    ID_CONSOLA INT CHECK (ID_CONSOLA >= 0) PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL,
    ID_FABRICANTE INT CHECK (ID_FABRICANTE >= 0),
    FECHA_LANZAMIENTO DATE,
    GENERACION INT CHECK(GENERACION >0 AND GENERACION <10),
    
    CONSTRAINT FK_CONSOLA_DESA FOREIGN KEY (ID_FABRICANTE) REFERENCES DESARROLLADORES(ID_DESARROLLADORA)
)
--drop table consolas

CREATE TABLE GENEROS(
    ID_GENERO INT CHECK(ID_GENERO >= 0) PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL
)
--drop table generos

CREATE TABLE JUEGO_GENERO(
    ID_JUEGO INT CHECK(ID_JUEGO >= 0),
    ID_GENERO INT CHECK (ID_GENERO >= 0),
    
    CONSTRAINT PK_JUEGO_GENERO PRIMARY KEY (ID_JUEGO, ID_GENERO),
    CONSTRAINT FK_JUEGO FOREIGN KEY (ID_JUEGO) REFERENCES VIDEOJUEGOS(ID_VIDEOJUEGOS),
    CONSTRAINT FK_GENERO FOREIGN KEY (ID_GENERO) REFERENCES GENEROS(ID_GENERO)
);
--drop table juego_genero

--INSERCIONES DESARROLLADORES
INSERT INTO DESARROLLADORES VALUES (1, 'CD PROJEKT RED', 'POLONIA', TO_DATE('1994-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (2, 'NINTENDO EPD', 'JAPON', TO_DATE('1889-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (3, 'ROCKSTAR GAMES', 'EEUU', TO_DATE('1998-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (4, 'MOJANG STUDIOS', 'SUECIA', TO_DATE('2009-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (5, 'SONY INTERACTIVE', 'JAPON', TO_DATE('1993-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (6, 'INSOMNIAC GAMES', 'EEUU', TO_DATE('1994-10-01', 'YYYY-MM-DD'));
INSERT INTO DESARROLLADORES VALUES (7, 'MICROSOFT', 'EEUU', TO_DATE('1975-10-01', 'YYYY-MM-DD'));


--INSERCIONES VIDEOJUEGOS
INSERT INTO VIDEOJUEGOS VALUES(1, 'CYBERPUNK 2077', '+18', 1);
INSERT INTO VIDEOJUEGOS VALUES(2, 'THE LEGEND OF ZELDA BREATH OF THE WILD', '+12', 2);
INSERT INTO VIDEOJUEGOS VALUES(3, 'RED DEAD REDEMPTION 2', '+18', 3);
INSERT INTO VIDEOJUEGOS VALUES(4, 'MINECRAFT', '+7', 4);
INSERT INTO VIDEOJUEGOS VALUES(5, 'SPYRO THE DRAGON', '+3', 6);

--INSERCIONES CONSOLAS
INSERT INTO CONSOLAS VALUES(1, 'PLAYSTATION', 5, TO_DATE('03-12-1994', 'DD-MM-YYYY'), 5);
INSERT INTO CONSOLAS VALUES(2, 'PLAYSTATION 4', 5, TO_DATE('15-11-2013', 'DD-MM-YYYY'), 8);
INSERT INTO CONSOLAS VALUES(3, 'PLAYSTATION 5', 5, TO_DATE('12-11-2020', 'DD-MM-YYYY'), 9);
INSERT INTO CONSOLAS VALUES(4, 'XBOX SERIES X', 7, TO_DATE('10-11-2020', 'DD-MM-YYYY'), 9);
INSERT INTO CONSOLAS VALUES(5, 'NINTENDO SWITCH', 2, TO_DATE('03-03-2017', 'DD-MM-YYYY'), 8);

--INSERCIONES GENEROS
INSERT INTO GENEROS VALUES(1, 'RPG');
INSERT INTO GENEROS VALUES(2, 'AVENTURA');
INSERT INTO GENEROS VALUES(3, 'ACCION');
INSERT INTO GENEROS VALUES(4, 'SANDBOX');
INSERT INTO GENEROS VALUES(5, '3RD PERSON SHOOTER');

--INSERCIONES JUEGO_GENERO
INSERT INTO JUEGO_GENERO VALUES(1,1);
INSERT INTO JUEGO_GENERO VALUES(1,3);
INSERT INTO JUEGO_GENERO VALUES(1,5);
INSERT INTO JUEGO_GENERO VALUES(2,2);
INSERT INTO JUEGO_GENERO VALUES(2,3);
INSERT INTO JUEGO_GENERO VALUES(3,3);
INSERT INTO JUEGO_GENERO VALUES(3,4);
INSERT INTO JUEGO_GENERO VALUES(3,5);
INSERT INTO JUEGO_GENERO VALUES(4,4);
INSERT INTO JUEGO_GENERO VALUES(5,2);
INSERT INTO JUEGO_GENERO VALUES(5,3);

--INSERCIONES LANZAMIENTOS
INSERT INTO LANZAMIENTOS VALUES(1,2,'10-12-2020');
INSERT INTO LANZAMIENTOS VALUES(1,3,'14-02-2022');
INSERT INTO LANZAMIENTOS VALUES(1,4,'14-12-2022');
INSERT INTO LANZAMIENTOS VALUES(2,5,'03-03-2017');
INSERT INTO LANZAMIENTOS VALUES(3,2,'26-10-2018');
INSERT INTO LANZAMIENTOS VALUES(4,2,'04-09-2014');
INSERT INTO LANZAMIENTOS VALUES(4,5,'12-05-2017');
INSERT INTO LANZAMIENTOS VALUES(5,1,'09-09-1998');

--CONSULTAS
--1
SELECT * FROM VIDEOJUEGOS JOIN DESARROLLADORES ON videojuegos.id_desarrolladora = desarrolladores.id_desarrolladora WHERE DESARROLLADORES.PAIS_ORIGEN='JAPON';

--2
SELECT v.* FROM VIDEOJUEGOS V 
    WHERE v.pegi > (SELECT MAX(PEGI) FROM VIDEOJUEGOS VD JOIN DESARROLLADORES D 
        ON vd.id_desarrolladora = d.id_desarrolladora WHERE d.pais_origen = 'SUECIA');

--3
SELECT * FROM DESARROLLADORES D JOIN VIDEOJUEGOS V ON d.id_desarrolladora = v.id_desarrolladora
    JOIN LANZAMIENTOS L ON v.id_videojuegos = l.id_videojuegos WHERE l.fecha_lanzamiento > '01-01-2015';

--4
SELECT v.TITULO, COUNT(DISTINCT l.ID_CONSOLA) AS consolas_disponibles 
FROM VIDEOJUEGOS V 
JOIN LANZAMIENTOS L ON V.id_videojuegos = L.id_videojuegos 
GROUP BY v.titulo HAVING COUNT(DISTINCT L.ID_CONSOLA) > (
    SELECT COUNT(DISTINCT L2.ID_CONSOLA)
    FROM VIDEOJUEGOS V2 
    JOIN LANZAMIENTOS L2 ON V2.ID_VIDEOJUEGOS = L2.ID_VIDEOJUEGOS 
    WHERE V2.TITULO = 'Cyberpunk 2077');

--5
SELECT l.fecha_lanzamiento FROM LANZAMIENTOS L JOIN CONSOLA C ON l.id_consola =C.ID_CONSOLA  WHERE C.NOMBRE = 'NINTENDO SWITCH';

--6
SELECT j.titulo, jg.id_juego FROM JUEGO_GENERO JG JOIN videojuegos J ON j.id_videojuegos = jg.id_juego WHERE jg.id_juego = NULL;

--7
SELECT v.TITULO FROM VIDEOJUEGOS v JOIN LANZAMIENTOS l ON v.ID_VIDEOJUEGOS = l.ID_VIDEOJUEGOS
JOIN CONSOLAS c ON l.ID_CONSOLA = c.ID_CONSOLA
WHERE c.ID_FABRICANTE = 5; 

--8
SELECT d.año_fundacion, d.nombre FROM Desarrolladores D WHERE d.pais_origen = 'EEUU' ORDER BY d.año_fundacion ASC;

--9
SELECT v.titulo FROM videojuegos v JOIN juego_genero jg ON v.id_videojuegos = jg.id_juego WHERE jg.id_genero NOT IN
(SELECT id_genero FROM juego_genero JOIN generos on juego_genero.id_genero = generos.id_genero where generos.nombre = '3RD PERSON SHOOTER');

--10
SELECT titulo FROM videojuegos where titulo LIKE 'THE %';

--11
SELECT g.nombre FROM generos G where g.nombre LIKE '________';

--12
SELECT d.NOMBRE AS DESARROLLADORA, c.NOMBRE AS CONSOLA FROM DESARROLLADORES d
JOIN CONSOLAS c ON d.ID_DESARROLLADORA = c.ID_FABRICANTE;

--13
SELECT v.TITULO FROM VIDEOJUEGOS v JOIN JUEGO_GENERO jg ON v.ID_VIDEOJUEGOS = jg.ID_JUEGO
GROUP BY v.TITULO HAVING COUNT(jg.ID_GENERO) > 1;

--14
SELECT jg.id_juego FROM juego_genero jg JOIN videojuegos v ON jg.id_juego = v.id_videojuegos 
GROUP BY v.titulo, jg.id_juego HAVING COUNT(jg.id_genero)>2 ;

--15
SELECT consolas.nombre FROM consolas where consolas.fecha_lanzamiento = (SELECT min(fecha_lanzamiento FROM consolas);

--16
DELETE FROM generacion;

--17
DELETE FROM lanzamientos WHERE id_consola = 2;

select * from lanzamientos join consolas on lanzamientos.id_consola = consolas.id_consola;


--18
SELECT D.PAIS_ORIGEN, AVG(V.PEGI) AS MEDIA_PEGI
FROM DESARROLLADORES D 
JOIN VIDEOJUEGOS V ON D.ID_DESARROLLADORA = V.ID_DESARROLLADORA
GROUP BY D.PAIS_ORIGEN;

--19
SELECT V.ID_VIDEOJUEGOS, G.NOMBRE, D.NOMBRE FROM VIDEOJUEGOS V 
JOIN JUEGO_GENERO JG ON V.ID_VIDEOJUEGOS = JG.ID_JUEGO
JOIN GENEROS G ON JG.ID_GENERO = G.ID_GENERO
JOIN DESARROLLADORES D ON V.ID_DESARROLLADORA = D.ID_DESARROLLADORA

--20
SELECT C.GENERACION, C.NOMBRE, C.ID_CONSOLA, V.TITULO, G.NOMBRE FROM CONSOLAS C 
JOIN LANZAMIENTOS L ON C.FECHA_LANZAMIENTO = L.FECHA_LANZAMIENTO
JOIN VIDEOJUEGOS V ON L.ID_VIDEOJUEGOS = V.ID_VIDEOJUEGOS
JOIN JUEGO_GENERO JG ON V.ID_VIDEOJUEGOS = JG.ID_JUEGO
JOIN GENEROS G ON JG.ID_GENERO = G.ID_GENERO WHERE GENERACION = 9

--21
SELECT V.ID_VIDEOJUEGOS, G.NOMBRE, D.NOMBRE FROM VIDEOJUEGOS V 
JOIN JUEGO_GENERO JG ON V.ID_VIDEOJUEGOS = JG.ID_JUEGO
JOIN GENEROS G ON JG.ID_GENERO = G.ID_GENERO
JOIN DESARROLLADORES D ON V.ID_DESARROLLADORA = D.ID_DESARROLLADORA

--22
SELECT V.TITULO, COUNT(DISTINCT C.GENERACION) FROM VIDEOJUEGOS V
JOIN LANZAMIENTOS L ON V.ID_VIDEOJUEGOS = L.ID_VIDEOJUEGOS
JOIN CONSOLAS C ON L.ID_CONSOLA = C.ID_CONSOLA 
GROUP BY V.TITULO HAVING COUNT(C.GENERACION) > 1; 
