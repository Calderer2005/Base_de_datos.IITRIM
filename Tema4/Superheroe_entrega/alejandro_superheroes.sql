CREATE TABLE EQUIPO (
    ID_EQUIPO INT PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL
)

CREATE TABLE PODERES (
    ID_PODER INT PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL
)

CREATE TABLE SUPERHEROES (
    ID_SUPERHEROE INT PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL,
    ALIAS VARCHAR(50) NOT NULL,
    CIUDAD_ORIGEN VARCHAR(50),
    ID_EQUIPO INT,
    
    CONSTRAINT FK_EQUIPO_SUPER FOREIGN KEY (ID_EQUIPO) REFERENCES EQUIPO(ID_EQUIPO)
)

CREATE TABLE VILLANOS (
    ID_VILLANO INT PRIMARY KEY,
    NOMBRE VARCHAR(25) NOT NULL,
    ALIAS VARCHAR(50) NOT NULL,
    CIUDAD_ORIGEN VARCHAR(50)
)

CREATE TABLE VILLANO_PODER (
    ID_VILLANO INT,
    ID_PODER INT,
    
    CONSTRAINT PK_VILLANO_PODER PRIMARY KEY (ID_VILLANO, ID_PODER),
    CONSTRAINT FK_VILLANO FOREIGN KEY (ID_VILLANO) REFERENCES VILLANOS(ID_VILLANO),
    CONSTRAINT FK_PODER FOREIGN KEY (ID_PODER) REFERENCES PODERES(ID_PODER)
)

CREATE TABLE SUPER_PODER (
    ID_SUPERHEROE INT,
    ID_PODER INT,
    
    CONSTRAINT PK_SUPER_PODER PRIMARY KEY (ID_SUPERHEROE, ID_PODER),
    CONSTRAINT FK_SUPER FOREIGN KEY (ID_SUPERHEROE) REFERENCES SUPERHEROES(ID_SUPERHEROE),
    CONSTRAINT FK_PODER_HEROE FOREIGN KEY (ID_PODER) REFERENCES PODERES(ID_PODER)
)

-- Inserciones en PERSONAJE
INSERT INTO SUPERHEROES VALUES (1, 'Clark Kent', 'Superman', 'Metropolis', 1);
INSERT INTO SUPERHEROES VALUES (2, 'Bruce Wayne', 'Batman', 'Gotham City', 1);
INSERT INTO SUPERHEROES VALUES (3, 'Tony Stark', 'Iron Man', 'Long Island', 2);
INSERT INTO SUPERHEROES VALUES (4, 'Wolverine', 'Logan', 'Alberta', 3);
INSERT INTO SUPERHEROES VALUES (5, 'Gar', 'Chico Bestia', 'New York', 5);

-- Inserciones en EQUIPO
INSERT INTO EQUIPO VALUES (1, 'Justice League');
INSERT INTO EQUIPO VALUES (2, 'Avengers');
INSERT INTO EQUIPO VALUES (3, 'X-Men');
INSERT INTO EQUIPO VALUES (4, 'Fantastic Four');
INSERT INTO EQUIPO VALUES (5, 'Teen Titans');

-- Inserciones en PODERES
INSERT INTO PODERES VALUES (1, 'Super Strength');
INSERT INTO PODERES VALUES (2, 'Flight');
INSERT INTO PODERES VALUES (3, 'Invisibility');
INSERT INTO PODERES VALUES (4, 'Healing Factor');
INSERT INTO PODERES VALUES (5, 'Transformation');

-- Inserciones en VILLANOS
INSERT INTO VILLANOS VALUES (1, 'Lex Luthor', 'Lex Luthor', 'Metropolis');
INSERT INTO VILLANOS VALUES (2, 'Joker', 'Joker', 'Gotham');
INSERT INTO VILLANOS VALUES (3, 'Thanos', 'Thanos', 'Titan');
INSERT INTO VILLANOS VALUES (4, 'Magneto', 'Magneto', 'Poland');
INSERT INTO VILLANOS VALUES (5, 'Deathstroke', 'Slade Wilson', 'New York');

-- Inserciones en VILLANO_PODER
INSERT INTO VILLANO_PODER VALUES (1, 1);
INSERT INTO VILLANO_PODER VALUES (2, 2);
INSERT INTO VILLANO_PODER VALUES (3, 3);
INSERT INTO VILLANO_PODER VALUES (4, 4);
INSERT INTO VILLANO_PODER VALUES (5, 5);

-- Inserciones en SUPER_PODER
INSERT INTO SUPER_PODER VALUES (1, 1);
INSERT INTO SUPER_PODER VALUES (2, 2);
INSERT INTO SUPER_PODER VALUES (3, 3);
INSERT INTO SUPER_PODER VALUES (4, 4);
INSERT INTO SUPER_PODER VALUES (5, 5);

--1
ALTER TABLE SUPERHEROES ADD EDAD INT;

--2
ALTER TABLE SUPERHEROES MODIFY NOMBRE VARCHAR(100);

--3
ALTER TABLE SUPERHEROES
    RENAME TO PERSONAJE;
    
--4
SELECT * FROM PERSONAJE;

--5
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE CIUDAD_ORIGEN = 'New York';

--6
SELECT NOMBRE, ALIAS, 
       (SELECT NOMBRE FROM EQUIPO WHERE EQUIPO.ID_EQUIPO = PERSONAJE.ID_EQUIPO) AS EQUIPO
FROM PERSONAJE
WHERE ID_EQUIPO IS NOT NULL;

--7
SELECT COUNT(*) AS NUMERO_VILLANOS FROM VILLANOS;

--8
SELECT ALIAS, 
       (SELECT NOMBRE FROM PODERES WHERE PODERES.ID_PODER = VILLANO_PODER.ID_PODER) AS PODER
FROM VILLANO_PODER, VILLANOS
WHERE VILLANO_PODER.ID_VILLANO = VILLANOS.ID_VILLANO;


--9
SELECT NOMBRE, ALIAS, 
       (SELECT NOMBRE FROM EQUIPO WHERE EQUIPO.ID_EQUIPO = PERSONAJE.ID_EQUIPO) AS EQUIPO,
       (SELECT NOMBRE FROM PODERES WHERE PODERES.ID_PODER = (SELECT ID_PODER FROM SUPER_PODER 
                                  WHERE SUPER_PODER.ID_SUPERHEROE = PERSONAJE.ID_SUPERHEROE)) AS PODER
FROM PERSONAJE

UNION ALL

SELECT NOMBRE, ALIAS, NULL AS EQUIPO,
       (SELECT NOMBRE FROM PODERES WHERE PODERES.ID_PODER = (SELECT ID_PODER FROM VILLANO_PODER 
                                  WHERE VILLANO_PODER.ID_VILLANO = VILLANOS.ID_VILLANO)) AS PODER
FROM VILLANOS;

--10
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_EQUIPO = (SELECT ID_EQUIPO FROM EQUIPO WHERE NOMBRE = 'Avengers');

--11
SELECT NOMBRE, ALIAS 
FROM PERSONAJE WHERE ID_SUPERHEROE IN (SELECT ID_SUPERHEROE FROM SUPER_PODER WHERE ID_PODER IN 
            (SELECT ID_PODER FROM SUPER_PODER GROUP BY ID_PODER HAVING COUNT(*) > 1
    )
);

--12
SELECT ID_EQUIPO,(SELECT NOMBRE FROM EQUIPO WHERE EQUIPO.ID_EQUIPO = PERSONAJE.ID_EQUIPO) AS EQUIPO, COUNT(*) AS CANTIDAD
    FROM PERSONAJE
    GROUP BY ID_EQUIPO;

--13
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_SUPERHEROE = (SELECT ID_SUPERHEROE FROM SUPER_PODER 
                       GROUP BY ID_SUPERHEROE 
                       ORDER BY COUNT(*) DESC);
                       
--14
SELECT AVG(CANTIDAD) AS MEDIA_PODERES FROM (SELECT COUNT(*) AS CANTIDAD FROM SUPER_PODER 
    GROUP BY ID_SUPERHEROE);
    
--15
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_SUPERHEROE = (SELECT ID_SUPERHEROE FROM SUPER_PODER 
                       GROUP BY ID_SUPERHEROE 
                       ORDER BY COUNT(*) ASC);
                       
--16
SELECT ID_PODER , (SELECT NOMBRE FROM PODERES WHERE PODERES.ID_PODER = SUPER_PODER.ID_PODER) AS PODER,
    (SELECT COUNT(*) FROM SUPER_PODER WHERE SUPER_PODER.ID_PODER = SUPER_PODER.ID_PODER) AS HEROE,
        (SELECT COUNT(*) FROM VILLANO_PODER WHERE VILLANO_PODER.ID_PODER = SUPER_PODER.ID_PODER) AS VILLANO
FROM SUPER_PODER 
GROUP BY ID_PODER;

--17
SELECT NOMBRE,ALIAS FROM PERSONAJE WHERE PERSONAJE.ID_SUPERHEROE NOT IN 
            (SELECT ID_SUPERHEROE FROM SUPER_PODER WHERE ID_PODER = (SELECT ID_PODER FROM PODERES WHERE NOMBRE = 'Flight'));
            
--18
SELECT NOMBRE, ALIAS FROM PERSONAJE
WHERE (SELECT COUNT(*) FROM SUPER_PODER WHERE SUPER_PODER.ID_SUPERHEROE = PERSONAJE.ID_SUPERHEROE) 
      > 
      (SELECT COUNT(*) FROM SUPER_PODER 
       WHERE ID_SUPERHEROE = (SELECT ID_SUPERHEROE FROM PERSONAJE WHERE ALIAS = 'Spider-Man'));

-- 19
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_EQUIPO IS NULL;

-- 20
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_SUPERHEROE IN 
      (SELECT ID_SUPERHEROE FROM SUPER_PODER WHERE ID_PODER IN 
        (SELECT ID_PODER FROM SUPER_PODER WHERE ID_SUPERHEROE = 
            (SELECT ID_SUPERHEROE FROM PERSONAJE WHERE ALIAS = 'Capitán América')));

-- 21
SELECT NOMBRE, ALIAS FROM PERSONAJE WHERE ID_EQUIPO IS NULL 
AND ID_SUPERHEROE IN (SELECT ID_SUPERHEROE FROM SUPER_PODER GROUP BY ID_SUPERHEROE HAVING COUNT(ID_PODER) > 2
);

-- 22
DELETE FROM VILLANOS WHERE ID_VILLANO NOT IN (SELECT ID_VILLANO FROM VILLANO_PODER);

-- 23
UPDATE PERSONAJE SET NOMBRE = 'Miles Morales' WHERE ALIAS = 'Spider-Man';

-- 24
INSERT INTO PERSONAJE VALUES (6, 'Marc Spector', 'Moon Knight', 'Chicago', NULL);

-- 25
UPDATE PERSONAJE SET ID_EQUIPO = (SELECT ID_EQUIPO FROM EQUIPO WHERE NOMBRE = 'Avengers') WHERE ALIAS = 'Moon Knight';

-- 26
DELETE FROM PERSONAJE WHERE ID_EQUIPO IS NULL;

-- 27
DELETE FROM PERSONAJE WHERE ID_SUPERHEROE NOT IN (SELECT ID_SUPERHEROE FROM SUPER_PODER 
    WHERE ID_PODER = (SELECT ID_PODER FROM PODERES WHERE NOMBRE = 'Flight')
);

DELETE FROM VILLANOS WHERE ID_VILLANO NOT IN (SELECT ID_VILLANO 
    FROM VILLANO_PODER WHERE ID_PODER = (SELECT ID_PODER FROM PODERES WHERE NOMBRE = 'Flight')
);

-- 28
SELECT NOMBRE, ALIAS FROM VILLANOS 
WHERE ID_VILLANO IN (
    SELECT ID_VILLANO FROM VILLANO_PODER 
    WHERE ID_PODER = (SELECT ID_PODER FROM PODERES WHERE NOMBRE = 'Super Strength')
)
AND ID_VILLANO IN (
    SELECT ID_VILLANO FROM VILLANO_PODER 
    WHERE ID_PODER = (SELECT ID_PODER FROM PODERES WHERE NOMBRE = 'Flight')
);
       
            
            
            
            